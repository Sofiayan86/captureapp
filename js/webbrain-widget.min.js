!function(){window.WebBrain=window.WebBrain||{},WebBrain.config={userId:null,position:"top-right",theme:"light",welcomeMessage:"Hello! How can I help you today?",buttonText:null,autoOpen:!1,apiEndpoint:"https://handle-request-cuw7veuocq-uc.a.run.app",buttonIcon:null,widgetTitle:"Your Website AI Agent",brandColor:"#3CB371",googleClientId:"568470231919-k5kbfjpk45uc89e5ahe6245qepco7f9f.apps.googleusercontent.com",backendAuthUrl:"https://us-central1-webbrain-63987.cloudfunctions.net/handle_capture_auth",requireLogin:!0,loginWelcomeMessage:"Welcome to WebBrain AI",chatModuleUrl:"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"/chatModule.js":"https://me.webbrain.app/chatModule.js",chatUiUrl:"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"/chatUI.js":"https://me.webbrain.app/chatUI.js",callbacks:{onOpen:null,onClose:null,onMessage:null,onResponse:null}},WebBrain.auth={isAuthenticated:!1,currentUser:null,firebaseAuth:null},WebBrain.init=function(n){if(n)for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))if("callbacks"===e&&n.callbacks)for(const e in n.callbacks)Object.prototype.hasOwnProperty.call(n.callbacks,e)&&(WebBrain.config.callbacks[e]=n.callbacks[e]);else WebBrain.config[e]=n[e];return WebBrain.config.userId&&"your-user-id-here"!==WebBrain.config.userId?(window.USER_ID=WebBrain.config.userId,console.log("WebBrain: User ID configured.")):console.warn("WebBrain: No valid User ID provided. Widget will operate in demo mode."),WebBrain._loadDependencies([{name:"marked",src:"https://cdn.jsdelivr.net/npm/marked/marked.min.js"},{name:"ChatUI",src:WebBrain.config.chatUiUrl},{name:"ChatModule",src:WebBrain.config.chatModuleUrl}]),WebBrain._injectStyles(),WebBrain._createWidgetButton(),WebBrain._createWidgetPanel(),WebBrain._initFirebase(),WebBrain._setupEventListeners(),WebBrain.config.autoOpen&&setTimeout((()=>WebBrain.open()),1e3),console.log("WebBrain widget initialized successfully"),WebBrain},WebBrain.open=function(){return WebBrain.panel&&(WebBrain.panel.classList.add("open"),document.body.classList.add("web-brain-open"),WebBrain.button.style.display="none",WebBrain.button.style.visibility="hidden",!0!==WebBrain.config.requireLogin||WebBrain.auth.isAuthenticated?WebBrain._hideLoginOverlay():WebBrain._showLoginOverlay(),"function"==typeof WebBrain.config.callbacks.onOpen&&WebBrain.config.callbacks.onOpen()),WebBrain},WebBrain.close=function(){return WebBrain.panel&&(WebBrain.panel.classList.remove("open"),document.body.classList.remove("web-brain-open"),WebBrain.button.style.display="flex",WebBrain.button.style.visibility="visible","function"==typeof WebBrain.config.callbacks.onClose&&WebBrain.config.callbacks.onClose()),WebBrain},WebBrain.toggle=function(){return WebBrain.panel&&WebBrain.panel.classList.contains("open")?WebBrain.close():WebBrain.open(),WebBrain},WebBrain.sendMessage=function(n){if(!n||"string"!=typeof n||!n.trim())return console.error("WebBrain: Invalid message provided to sendMessage()"),WebBrain;const e=n.trim();return WebBrain.chatUiCallbacks&&WebBrain.chatUiCallbacks.displayMessage&&WebBrain.chatUiCallbacks.displayMessage({text:e,sender:"user"}),WebBrain._handleUserMessage(e),WebBrain},WebBrain.updateConfig=function(n){if(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))if("callbacks"===e&&n.callbacks)for(const e in n.callbacks)Object.prototype.hasOwnProperty.call(n.callbacks,e)&&(WebBrain.config.callbacks[e]=n.callbacks[e]);else WebBrain.config[e]=n[e];n.position&&WebBrain.button&&(WebBrain.button.className="web-brain-widget-button "+n.position),n.theme&&WebBrain.panel&&(WebBrain.panel.classList.remove("chat-theme-light","chat-theme-dark"),WebBrain.panel.classList.add("chat-theme-"+n.theme),WebBrain.chatUiCallbacks&&WebBrain.chatUiCallbacks.updateTheme&&WebBrain.chatUiCallbacks.updateTheme(n.theme)),n.buttonIcon&&WebBrain.button&&(WebBrain.button.innerHTML=n.buttonIcon),n.widgetTitle&&WebBrain.brandElement&&(WebBrain.brandElement.innerHTML=`\n          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="var(--chat-brand-color, ${WebBrain.config.brandColor})">\n            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 16c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6z"/>\n            <circle cx="12" cy="12" r="3" fill="var(--chat-brand-color, ${WebBrain.config.brandColor})"/>\n          </svg>\n          ${n.widgetTitle}\n        `),n.brandColor&&(document.documentElement.style.setProperty("--chat-brand-color",n.brandColor),WebBrain.chatUiCallbacks&&WebBrain.chatUiCallbacks.updateBrandColor&&WebBrain.chatUiCallbacks.updateBrandColor(n.brandColor)),n.userId&&(window.USER_ID=n.userId),(n.userId||n.welcomeMessage)&&WebBrain.chatModule&&(WebBrain._updateMessagesArea(),console.log("WebBrain: User ID updated."))}return WebBrain},WebBrain._initFirebase=function(){WebBrain._loadGoogleIdentityServices();const n=[{src:"https://www.gstatic.com/firebasejs/11.5.0/firebase-app-compat.js"},{src:"https://www.gstatic.com/firebasejs/11.5.0/firebase-auth-compat.js"}];let e=0;const o=()=>{e++,e===n.length&&WebBrain._initializeFirebaseApp()};n.forEach((({src:a})=>{if([...document.scripts].some((n=>n.src===a)))return e++,void(e===n.length&&WebBrain._initializeFirebaseApp());const i=document.createElement("script");i.src=a,i.async=!0,i.onload=o,document.head.appendChild(i)}))},WebBrain._initializeFirebaseApp=function(){const n=()=>{if("undefined"!=typeof firebase)try{const n={apiKey:"AIzaSyDo_tVBrhMclamvzHMsL3kqb3mqgNmLpuo",authDomain:"webbrain-63987.firebaseapp.com",projectId:"webbrain-63987",storageBucket:"webbrain-63987.firebasestorage.app",messagingSenderId:"568470231919",appId:"1:568470231919:web:41016d7b531f68f4c3669a",measurementId:"G-0J6R1ZM1Y4"},e=firebase.initializeApp(n);WebBrain.auth.firebaseAuth=e.auth(),WebBrain._setupAuthStateListener(),console.log("WebBrain: Firebase initialized successfully")}catch(n){console.error("WebBrain: Firebase initialization error:",n)}else setTimeout(n,100)};n()},WebBrain._loadGoogleIdentityServices=function(){const n=document.createElement("script");n.src="https://accounts.google.com/gsi/client",n.async=!0,n.onload=()=>{console.log("WebBrain: Google Identity Services loaded"),WebBrain._checkAndInitializeGoogleButton()},document.head.appendChild(n)},WebBrain._checkAndInitializeGoogleButton=function(e=0){if(window.google&&WebBrain.loginOverlay){if(WebBrain.loginOverlay.querySelector(".web-brain-google-login-button"))return n(),void console.log("WebBrain: All dependencies loaded, Google button initialized")}e<5?(console.log(`WebBrain: Google Sign-In button not found, retrying... (${e+1}/5)`),setTimeout((()=>WebBrain._checkAndInitializeGoogleButton(e+1)),500*(e+1))):console.error("WebBrain: Failed to initialize Google Sign-In button after maximum retries")},WebBrain._setupAuthStateListener=function(){WebBrain.auth.firebaseAuth.onAuthStateChanged((n=>{WebBrain._showLoginLoading(!1),n?(console.log("WebBrain: User is signed in:",n.displayName),WebBrain.auth.isAuthenticated=!0,WebBrain.auth.currentUser=n,localStorage.setItem("webbrainWidgetUser",JSON.stringify({uid:n.uid,displayName:n.displayName,email:n.email,photoURL:n.photoURL})),WebBrain._hideLoginOverlay(),WebBrain._updateMessagesArea()):(console.log("WebBrain: User is signed out"),WebBrain.auth.isAuthenticated=!1,WebBrain.auth.currentUser=null,localStorage.removeItem("webbrainWidgetUser"),WebBrain.chatModule&&"function"==typeof WebBrain.chatModule.clearHistory&&WebBrain.chatModule.clearHistory())}))};const n=()=>{try{google.accounts.id.initialize({client_id:WebBrain.config.googleClientId,callback:WebBrain._handleGoogleAuth});const n=WebBrain.loginOverlay.querySelector(".web-brain-google-login-button");n&&(google.accounts.id.renderButton(n,{width:document.getElementById("web-brain-google-login-container").offsetWidth||"auto"}),console.log("WebBrain: Google Sign In button rendered"))}catch(n){console.error("WebBrain: Error initializing Google button:",n),WebBrain._showLoginError(`Failed to initialize login: ${n.message}`)}};WebBrain._handleGoogleAuth=async function(n){const e=WebBrain.loginOverlay.querySelector(".web-brain-login-error");e&&(e.style.display="none"),WebBrain._showLoginLoading(!0,"Signing in...");try{console.log("WebBrain: Got Google credential, authenticating with backend");const e=n.credential,o=WebBrain.config.backendAuthUrl,a=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id_token:e,action:"google_auth"})});if(!a.ok){const n=await a.text();return console.error("WebBrain: Backend Error:",a.status,n),void WebBrain._showLoginError(`Authentication failed (${a.status})`)}const i=await a.json();if(console.log("WebBrain: Backend response received"),i.firebase_custom_token){WebBrain._showLoginLoading(!0,"Verifying credentials...");const n=WebBrain.auth.firebaseAuth;return await n.signInWithCustomToken(i.firebase_custom_token),console.log("WebBrain: Successfully authenticated"),!0}WebBrain._showLoginError("Authentication failed: Server did not return a valid token"),console.error("WebBrain: Firebase custom token not returned from server")}catch(n){console.error("WebBrain: Error with authentication:",n),WebBrain._showLoginError(`Login error: ${n.message}`)}},WebBrain._showLoginLoading=function(n,e="Processing..."){if(!WebBrain.loginOverlay)return;let o=WebBrain.loginOverlay.querySelector(".web-brain-login-loading");if(n){if(!o){o=document.createElement("div"),o.className="web-brain-login-loading",o.style.display="flex",o.style.flexDirection="column",o.style.alignItems="center",o.style.justifyContent="center",o.style.marginTop="20px",o.style.padding="12px",o.style.backgroundColor="rgba(0, 0, 0, 0.05)",o.style.borderRadius="4px";const n=document.createElement("div");n.className="web-brain-login-spinner",n.style.border="3px solid rgba(0, 0, 0, 0.1)",n.style.borderTopColor="var(--chat-brand-color, "+WebBrain.config.brandColor+")",n.style.borderRadius="50%",n.style.width="24px",n.style.height="24px",n.style.animation="web-brain-spin 1s linear infinite";const e=document.createElement("div");if(e.className="web-brain-login-loading-text",e.style.marginTop="8px",e.style.color="var(--wb-text-secondary)",e.style.fontSize="14px",!document.querySelector("#web-brain-spinner-style")){const n=document.createElement("style");n.id="web-brain-spinner-style",n.textContent="\n            @keyframes web-brain-spin {\n              0% { transform: rotate(0deg); }\n              100% { transform: rotate(360deg); }\n            }\n          ",document.head.appendChild(n)}o.appendChild(n),o.appendChild(e);WebBrain.loginOverlay.querySelector(".web-brain-login-content").appendChild(o)}o.style.display="flex";const n=o.querySelector(".web-brain-login-loading-text");n&&(n.textContent=e);const a=document.getElementById("web-brain-google-login-container");a&&(a.style.opacity="0.5",a.style.pointerEvents="none")}else if(o){o.style.display="none";const n=document.getElementById("web-brain-google-login-container");n&&(n.style.opacity="1",n.style.pointerEvents="auto")}},WebBrain._showLoginError=function(n){WebBrain._showLoginLoading(!1);let e=WebBrain.loginOverlay.querySelector(".web-brain-login-error");if(!e){e=document.createElement("div"),e.className="web-brain-login-error",e.style.backgroundColor="#ffebee",e.style.color="#d32f2f",e.style.padding="16px",e.style.marginTop="16px",e.style.borderRadius="4px",e.style.fontSize="14px",e.style.textAlign="center",e.style.position="relative";WebBrain.loginOverlay.querySelector(".web-brain-login-content").appendChild(e)}e.textContent=n,e.style.display="block";const o=document.createElement("button");o.textContent="✕",o.style.position="absolute",o.style.top="5px",o.style.right="5px",o.style.backgroundColor="transparent",o.style.border="none",o.style.color="#d32f2f",o.style.fontSize="14px",o.style.cursor="pointer",o.style.padding="2px 6px",o.style.margin="0",o.onclick=function(){e.style.display="none"},e.appendChild(o)},WebBrain._signOut=async function(){try{const n=WebBrain.auth.firebaseAuth;await n.signOut(),WebBrain._showLoginOverlay(),console.log("WebBrain: User signed out")}catch(n){console.error("WebBrain: Error signing out:",n)}},WebBrain._injectStyles=function(){const n=document.createElement("style");n.textContent=`\n      /* WebBrain Theme Variables */\n      .chat-theme-light {\n        --wb-background-color: #ffffff;\n        --wb-background-secondary: #f8f9fa;\n        --wb-text-color: #202124;\n        --wb-text-secondary: #5f6368;\n        --wb-border-color: #f1f3f4;\n        --wb-primary-color: var(--chat-brand-color, ${WebBrain.config.brandColor});\n        --wb-primary-light: color-mix(in srgb, var(--chat-brand-color, ${WebBrain.config.brandColor}) 20%, white);\n        --wb-shadow-color: rgba(60, 64, 67, 0.15);\n        --wb-input-border: #dadce0;\n        --wb-input-focus: #a8c7fa;\n      }\n      \n      .chat-theme-dark {\n        --wb-background-color: #1E1E1E;\n        --wb-background-secondary: #2E2E2E;\n        --wb-text-color: #E0E0E0;\n        --wb-text-secondary: #A0A0A0;\n        --wb-border-color: #444444;\n        --wb-primary-color: var(--chat-brand-color, ${WebBrain.config.brandColor});\n        --wb-primary-light: color-mix(in srgb, var(--chat-brand-color, ${WebBrain.config.brandColor}) 20%, black);\n        --wb-shadow-color: rgba(0, 0, 0, 0.3);\n        --wb-input-border: #444444;\n        --wb-input-focus: var(--chat-brand-color, ${WebBrain.config.brandColor});\n      }\n      \n      /* Login Overlay Styles */\n      .web-brain-login-overlay {\n        position: absolute;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        background-color: var(--wb-background-color);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 10;\n        flex-direction: column;\n      }\n      \n      .web-brain-login-content {\n        max-width: 320px;\n        text-align: center;\n        padding: 24px;\n        background-color: var(--wb-background-color);\n        border-radius: 8px;\n      }\n      \n      .web-brain-login-logo {\n        margin-bottom: 16px;\n      }\n      \n      .web-brain-login-message {\n        font-size: 20px;\n        font-weight: 500;\n        margin-bottom: 8px;\n        color: var(--wb-text-color);\n      }\n      \n      .web-brain-login-message-secondary {\n        font-size: 14px;\n        color: var(--wb-text-secondary);\n        margin-bottom: 24px;\n      }\n      \n      .web-brain-google-login-button {\n        margin: 0 auto;\n      }\n\n      /* WebBrain Component Styles */\n      body.web-brain-open {\n        transition: margin-right 0.5s ease;\n        margin-right: 40vw;\n      }\n      \n      .web-brain-widget-button {\n        position: fixed !important;\n        background-color: transparent !important;\n        color: var(--chat-brand-color, ${WebBrain.config.brandColor}) !important;\n        border: none !important;\n        border-radius: 0 !important;\n        width: 48px !important;\n        height: 48px !important;\n        cursor: pointer !important;\n        box-shadow: none !important;\n        z-index: 9999 !important;\n        display: flex !important;\n        align-items: center !important;\n        justify-content: center !important;\n        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;\n        overflow: visible !important;\n        padding: 0 !important;\n        margin: 0 !important;\n      }\n      \n      .web-brain-widget-button.top-right {\n        right: 20px !important;\n        top: 20px !important;\n      }\n      \n      .web-brain-widget-button.top-left {\n        left: 20px !important;\n        top: 20px !important;\n      }\n      \n      .web-brain-widget-button.bottom-right {\n        right: 20px !important;\n        bottom: 20px !important;\n      }\n      \n      .web-brain-widget-button.bottom-left {\n        left: 20px !important;\n        bottom: 20px !important;\n      }\n\n      .web-brain-widget-button:hover {\n        box-shadow: none !important;\n        transform: translateY(-2px) !important;\n        background-color: transparent !important;\n      }\n      \n      .web-brain-widget-button svg {\n        width: 24px !important;\n        height: 24px !important;\n        fill: var(--chat-brand-color, ${WebBrain.config.brandColor}) !important;\n      }\n\n      .chat-column {\n        position: fixed;\n        right: -40vw;\n        top: 0;\n        width: 40vw;\n        height: 100%;\n        background-color: var(--wb-background-color);\n        box-shadow: -4px 0 24px var(--wb-shadow-color);\n        transition: right 0.5s cubic-bezier(0.4, 0, 0.2, 1);\n        z-index: 999999;\n        display: flex;\n        flex-direction: column;\n        overflow: hidden;\n        border-radius: 0;\n      }\n\n      .chat-column.open {\n        right: 0;\n      }\n\n      .web-brain-header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        padding: 16px 20px;\n        border-bottom: 1px solid var(--wb-border-color);\n        background-color: var(--wb-background-color);\n        position: sticky;\n        top: 0;\n        z-index: 999999;\n      }\n      \n      .web-brain-brand {\n        display: flex;\n        align-items: center;\n        font-size: 18px;\n        font-weight: 500;\n        color: var(--wb-primary-color);\n      }\n      \n      .web-brain-brand svg {\n        margin-right: 8px;\n        fill: var(--wb-primary-color);\n      }\n      \n      .web-brain-actions {\n        display: flex;\n        gap: 8px;\n      }\n\n      .web-brain-action-button {\n        background: none;\n        border: none;\n        width: 36px;\n        height: 36px;\n        border-radius: 50%;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        color: var(--wb-text-secondary);\n        transition: background-color 0.2s;\n      }\n      \n      .web-brain-action-button:hover {\n        background-color: var(--wb-background-secondary);\n      }\n\n      .web-brain-messages {\n        flex: 1;\n        overflow-y: auto;\n        padding: 16px;\n        background-color: var(--wb-background-secondary);\n      }\n      \n      .message {\n        max-width: 80%;\n        margin-bottom: 16px;\n        padding: 12px 16px;\n        border-radius: 18px;\n        animation: messageAppear 0.3s forwards;\n        line-height: 1.4;\n        color: var(--wb-text-color);\n      }\n      \n      @keyframes messageAppear {\n        from {\n          opacity: 0;\n          transform: translateY(10px);\n        }\n        to {\n          opacity: 1;\n          transform: translateY(0);\n        }\n      }\n      \n      .message.user {\n        background-color: var(--wb-primary-light);\n        margin-left: auto;\n        border-bottom-right-radius: 4px;\n      }\n      \n      .message.ai {\n        background-color: var(--wb-background-color);\n        margin-right: auto;\n        border-bottom-left-radius: 4px;\n        box-shadow: 0 1px 2px var(--wb-shadow-color);\n        max-width: 85%;\n      }\n      \n      .web-brain-message-header {\n        display: flex;\n        align-items: center;\n        margin-bottom: 4px;\n        font-size: 12px;\n        color: var(--wb-text-secondary);\n      }\n      \n      .web-brain-message-icon {\n        margin-right: 8px;\n        display: flex;\n      }\n      \n      .message a {\n        color: var(--wb-primary-color);\n        text-decoration: none;\n        border-bottom: 1px solid var(--wb-primary-light);\n      }\n      \n      .message a:hover {\n        border-bottom: 1px solid var(--wb-primary-color);\n      }\n      \n      .message p {\n        margin: 0 0 12px 0;\n      }\n      \n      .message p:last-child {\n        margin-bottom: 0;\n      }\n      \n      .message ul,\n      .message ol {\n        margin: 8px 0;\n        padding-left: 24px;\n      }\n      \n      .message li {\n        margin-bottom: 4px;\n      }\n      \n      .message h2,\n      .message h3 {\n        margin: 16px 0 8px 0;\n        font-weight: 500;\n      }\n      \n      .message h2 {\n        font-size: 16px;\n      }\n      \n      .message h3 {\n        font-size: 14px;\n      }\n\n      .welcome-message {\n        text-align: center;\n        color: var(--wb-text-color);\n        margin: 20px 0;\n      }\n\n      /* Typing indicator animation */\n      .typing-indicator {\n        display: flex;\n        align-items: center;\n      }\n      \n      .typing-indicator span {\n        height: 8px;\n        width: 8px;\n        margin: 0 2px;\n        background-color: var(--wb-primary-color);\n        display: block;\n        border-radius: 50%;\n        opacity: 0.4;\n        animation: typing 1.4s infinite both;\n      }\n      \n      .typing-indicator span:nth-child(2) {\n        animation-delay: 0.2s;\n      }\n      \n      .typing-indicator span:nth-child(3) {\n        animation-delay: 0.4s;\n      }\n      \n      @keyframes typing {\n        0% { opacity: 0.4; transform: translateY(0); }\n        50% { opacity: 1; transform: translateY(-5px); }\n        100% { opacity: 0.4; transform: translateY(0); }\n      }\n\n      .message.ai.typing-container {\n        color: var(--wb-text-secondary);\n        border: 1px dashed var(--wb-border-color);\n      }\n\n      .web-brain-input-area {\n        padding: 16px;\n        border-top: 1px solid var(--wb-border-color);\n        background-color: var(--wb-background-color);\n      }\n      \n      .web-brain-input-form {\n        display: flex;\n        position: relative;\n      }\n      \n      .web-brain-input {\n        flex: 1;\n        border: 1px solid var(--wb-input-border);\n        border-radius: 24px;\n        padding: 12px 16px;\n        padding-right: 44px;\n        font-size: 14px;\n        font-family: inherit;\n        resize: none;\n        max-height: 120px;\n        min-height: 24px;\n        line-height: 1.4;\n        background-color: var(--wb-background-color);\n        color: var(--wb-text-color);\n        box-shadow: 0 1px 3px var(--wb-shadow-color);\n        transition: border-color 0.2s, box-shadow 0.2s;\n      }\n      \n      .web-brain-input:focus {\n        outline: none;\n        border-color: var(--wb-input-focus);\n        box-shadow: 0 1px 3px var(--wb-shadow-color);\n      }\n      \n      .web-brain-send-button {\n        position: absolute;\n        right: 8px;\n        bottom: 8px;\n        background: none;\n        border: none;\n        width: 32px;\n        height: 32px;\n        border-radius: 50%;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        color: var(--wb-primary-color);\n        opacity: 0.8;\n        transition: opacity 0.2s, background-color 0.2s;\n      }\n      \n      .web-brain-send-button:hover {\n        opacity: 1;\n        background-color: var(--wb-background-secondary);\n      }\n\n      /* Footer style */\n      .web-brain-footer {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        padding: 8px 20px;\n        border-top: 1px solid var(--wb-border-color);\n        background-color: var(--chat-brand-color, ${WebBrain.config.brandColor});\n        position: sticky;\n        bottom: 0;\n        z-index: 999;\n      }\n      \n      .chat-theme-light .web-brain-footer,\n      .chat-theme-light .web-brain-footer a {\n        color: white;\n      }\n      \n      .chat-theme-dark .web-brain-footer,\n      .chat-theme-dark .web-brain-footer a {\n        color: #333;\n      }\n      \n      .web-brain-footer a {\n        text-decoration: none;\n        font-size: 12px;\n        font-weight: 500;\n      }\n      \n      .web-brain-footer a:hover {\n        text-decoration: underline;\n      }\n\n      .web-brain-logout {\n        margin-left: 20px;\n        color: #333;\n        background-color: white;\n        border: none;\n        border-radius: 4px;\n        padding: 2px 8px;\n        font-size: 12px;\n        font-weight: 500;\n        cursor: pointer;\n        display: none; /* Hidden by default, shown when requireLogin is true */\n      }\n      \n      .web-brain-logout:hover {\n        background-color: #f1f1f1;\n      }\n\n      @media (max-width: 768px) {\n        .chat-column {\n          width: 85vw;\n          right: -85vw;\n        }\n        \n        body.web-brain-open {\n          margin-right: 85vw;\n        }\n        \n        .message {\n          max-width: 90%;\n        }\n      }\n    `,document.head.appendChild(n)},WebBrain._loadDependencies=function(n){console.log("WebBrain: Loading dependencies:",n.map((n=>n.name)).join(", "));const e=n.map((n=>new Promise(((e,o)=>{if(window[n.name])return console.log(`WebBrain: ${n.name} already loaded, skipping`),void e(window[n.name]);const a=document.createElement("script");a.src=n.src,a.async=!0,a.onload=()=>{console.log(`WebBrain: Successfully loaded ${n.name} from ${n.src}`),e(window[n.name])},a.onerror=e=>{console.error(`WebBrain: Failed to load ${n.name} from ${n.src}`,e),o(e)},document.head.appendChild(a)}))));return Promise.all(e).catch((n=>(console.error("WebBrain: Error loading dependencies:",n),Promise.reject(n))))},WebBrain._createWidgetButton=function(){const n=document.createElement("button");n.className="web-brain-widget-button "+WebBrain.config.position,n.id="webBrainBtn-"+WebBrain._generateId(),WebBrain.config.buttonIcon?n.innerHTML=WebBrain.config.buttonIcon:WebBrain.config.buttonText?n.innerHTML=WebBrain.config.buttonText:n.innerHTML=`\n        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 32 32" fill="var(--chat-brand-color, ${WebBrain.config.brandColor})">\n        <path d="m13.294 7.436.803 2.23a8.835 8.835 0 0 0 5.316 5.316l2.23.803a.229.229 0 0 1 0 .43l-2.23.803a8.835 8.835 0 0 0-5.316 5.316l-.803 2.23a.229.229 0 0 1-.43 0l-.803-2.23a8.835 8.835 0 0 0-5.316-5.316l-2.23-.803a.229.229 0 0 1 0-.43l2.23-.803a8.835 8.835 0 0 0 5.316-5.316l.803-2.23a.228.228 0 0 1 .43 0zM23.332 2.077l.407 1.129a4.477 4.477 0 0 0 2.692 2.692l1.129.407a.116.116 0 0 1 0 .218l-1.129.407a4.477 4.477 0 0 0-2.692 2.692l-.407 1.129a.116.116 0 0 1-.218 0l-.407-1.129a4.477 4.477 0 0 0-2.692-2.692l-1.129-.407a.116.116 0 0 1 0-.218l1.129-.407a4.477 4.477 0 0 0 2.692-2.692l.407-1.129a.116.116 0 0 1 .218 0zM23.332 21.25l.407 1.129a4.477 4.477 0 0 0 2.692 2.692l1.129.407a.116.116 0 0 1 0 .218l-1.129.407a4.477 4.477 0 0 0-2.692 2.692l-.407 1.129a.116.116 0 0 1-.218 0l-.407-1.129a4.477 4.477 0 0 0-2.692-2.692l-1.129-.407a.116.116 0 0 1 0-.218l1.129-.407a4.477 4.477 0 0 0 2.692-2.692l.407-1.129c.037-.102.182-.102.218 0z"/>\n        </svg>\n      `,document.body.appendChild(n),WebBrain.button=n},WebBrain._getWelcomeMessage=function(){const n=WebBrain.auth.currentUser?.displayName;let e=WebBrain.config.welcomeMessage;if(n)if(e.match(/^(Hello|Hi|Hey|Welcome)[,!]?(\s+)/i)){e=`Hello, ${n}! ${WebBrain.config.welcomeMessage.replace(/^(Hello|Hi|Hey|Welcome)[,!]?(\s+)(.)/i,(function(n,e,o,a){return a.toUpperCase()}))}`}else e=`Hello, ${n}! ${e}`;return e},WebBrain._updateMessagesArea=function(){WebBrain._initializeChatModules()},WebBrain._createWidgetPanel=function(){const n=document.createElement("div");n.className="chat-column chat-theme-"+WebBrain.config.theme,n.id="webBrain-"+WebBrain._generateId();const e=document.createElement("div");e.className="web-brain-header";const o=document.createElement("div");o.className="web-brain-brand",o.innerHTML=`\n      ${WebBrain.config.widgetTitle}\n    `,WebBrain.brandElement=o;const a=document.createElement("div");a.className="web-brain-actions";const i=document.createElement("button");i.className="web-brain-action-button",i.innerHTML=`\n      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" stroke="var(--chat-brand-color, ${WebBrain.config.brandColor})" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none">\n        <path d="M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7"/>\n      </svg>\n    `;const t=document.createElement("button");t.className="web-brain-action-button",t.innerHTML=`\n      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" stroke="var(--chat-brand-color, ${WebBrain.config.brandColor})" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none">\n        <line x1="18" y1="6" x2="6" y2="18"></line>\n        <line x1="6" y1="6" x2="18" y2="18"></line>\n      </svg>\n    `,a.appendChild(i),a.appendChild(t),e.appendChild(o),e.appendChild(a);const r=document.createElement("div");r.className="web-brain-messages";const l=document.createElement("div");l.className="web-brain-input-area";const s=document.createElement("form");s.className="web-brain-input-form";const c=document.createElement("textarea");c.className="web-brain-input",c.placeholder="Enter a prompt here",c.rows=1;const b=document.createElement("button");b.type="submit",b.className="web-brain-send-button",b.innerHTML=`\n      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" stroke="var(--chat-brand-color, ${WebBrain.config.brandColor})" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n        <line x1="22" y1="2" x2="11" y2="13"></line>\n        <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>\n      </svg>\n    `,s.appendChild(c),s.appendChild(b),l.appendChild(s);const d=document.createElement("div");d.className="web-brain-footer";const g=document.createElement("div");g.style.display="flex",g.style.justifyContent="center",g.style.alignItems="center",g.style.width="100%";const u=document.createElement("a");u.href="https://webbrain.app/?utm_source=website&utm_medium=widget",u.target="_blank",u.textContent="Powered by WebBrain — Always‑On Insight";const p=document.createElement("button");p.className="web-brain-logout",p.textContent="Logout",WebBrain.config.requireLogin&&(p.style.display="block"),p.addEventListener("click",(function(){WebBrain._signOut()})),WebBrain.logoutButton=p,g.appendChild(u),g.appendChild(p),d.appendChild(g),n.appendChild(e),n.appendChild(r),n.appendChild(l),n.appendChild(d),document.body.appendChild(n),WebBrain.panel=n,WebBrain.input=c,WebBrain.messagesArea=r,WebBrain.sendButton=b,WebBrain.inputForm=s,WebBrain.closeButton=t,WebBrain.footer=d,WebBrain.config.requireLogin||WebBrain._updateMessagesArea()},WebBrain._initializeChatModules=function(){if(!window.ChatUI||!window.ChatModule||!window.marked)return console.warn("WebBrain: Chat modules not available, loading required dependencies"),WebBrain._loadDependencies([{name:"marked",src:"https://cdn.jsdelivr.net/npm/marked/marked.min.js"},{name:"ChatUI",src:WebBrain.config.chatUiUrl},{name:"ChatModule",src:WebBrain.config.chatModuleUrl}]).then((()=>{WebBrain._initializeChatModules()})),!1;try{console.log("WebBrain: Initializing ChatUI and ChatModule");const n=WebBrain._getWelcomeMessage();WebBrain._initChatUI(n),WebBrain._initChatModule(),WebBrain.chatModule.enable();const e=!WebBrain.config.userId||"your-user-id-here"===WebBrain.config.userId;return console.log(`WebBrain: Chat modules initialized successfully (demoMode: ${e})`),!0}catch(n){return console.error("WebBrain: Error initializing chat modules:",n),!1}},WebBrain._initChatUI=function(n){const e={chatContainer:WebBrain.messagesArea,chatInput:WebBrain.input,sendMessageBtn:WebBrain.sendButton,markedLib:window.marked,sendMessageHandler:WebBrain._handleUserMessage,theme:WebBrain.config.theme,welcomeMessage:n,brandColor:WebBrain.config.brandColor,showAiMessageHeader:!0},o=window.ChatUI.init(e),a=o.displayMessage;o.displayMessage=function(n){if(a(n),"ai"===n.sender&&!n.isFromHistory&&!n.isPartial&&"function"==typeof WebBrain.config.callbacks.onResponse){const e=!WebBrain.config.userId||"your-user-id-here"===WebBrain.config.userId;WebBrain.config.callbacks.onResponse(n.text,e)}};const i=o.updateMessage;o.updateMessage=function(n){if(i(n),!n.isPartial&&"function"==typeof WebBrain.config.callbacks.onResponse){const e=!WebBrain.config.userId||"your-user-id-here"===WebBrain.config.userId;WebBrain.config.callbacks.onResponse(n.text,e)}},WebBrain.chatUiCallbacks=o},WebBrain._initChatModule=function(){const n=!WebBrain.config.userId||"your-user-id-here"===WebBrain.config.userId,e={apiEndpoint:WebBrain.config.apiEndpoint,localStorageKey:`webbrainWidget_${WebBrain.config.userId||"demo"}`,uiCallbacks:WebBrain.chatUiCallbacks};WebBrain.chatModule=window.ChatModule.init(e),n?(WebBrain.chatModule.setUser(null),console.log("WebBrain: Running in demo mode with null user")):(WebBrain.chatModule.setUser(WebBrain.config.userId),console.log("WebBrain: User ID set for authenticated mode:",WebBrain.config.userId))},WebBrain._setupEventListeners=function(){WebBrain.button.addEventListener("click",(function(){WebBrain.toggle()})),WebBrain.closeButton.addEventListener("click",(function(){WebBrain.close()}))},WebBrain._handleUserMessage=function(n){const e=!WebBrain.config.userId||"your-user-id-here"===WebBrain.config.userId;if("function"==typeof WebBrain.config.callbacks.onMessage&&WebBrain.config.callbacks.onMessage(n),e){if(WebBrain.chatModule){WebBrain.chatModule.disable&&WebBrain.chatModule.disable(),WebBrain.chatUiCallbacks&&WebBrain.chatUiCallbacks.showTypingIndicator&&WebBrain.chatUiCallbacks.showTypingIndicator();const e=Math.floor(500*Math.random())+1e3;setTimeout((()=>{if(WebBrain.chatUiCallbacks.hideTypingIndicator&&WebBrain.chatUiCallbacks.hideTypingIndicator(),WebBrain.chatUiCallbacks.displayMessage){const e=`[DEMO MODE] Thank you for your question about "${n}"!\n\nI found some information that might help. According to our documentation, this is a common question.\n\n**Key points:**\n\n- The WebBrain system can help you find information quickly\n- You can search through all your uploaded documents\n- Results are sorted by relevance\n\nFor more information, please check [documentation](https://me.webbrain.app/widget/integration-example.html).`;WebBrain.chatUiCallbacks.displayMessage({sender:"ai",text:e,isPartial:!1})}WebBrain.chatModule&&WebBrain.chatModule.enable&&WebBrain.chatModule.enable()}),e)}}else WebBrain.chatModule?WebBrain.chatModule.sendMessage(n):console.error("WebBrain: ChatModule not loaded. Cannot send message.")},WebBrain._generateId=function(){return Math.random().toString(36).substr(2,9)},WebBrain._createLoginOverlay=function(){const n=document.createElement("div");n.className="web-brain-login-overlay",n.innerHTML=`\n      <div class="web-brain-login-content">\n        <div class="web-brain-login-logo">\n          <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="var(--chat-brand-color, ${WebBrain.config.brandColor})">\n              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 16c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6z"/>\n            <circle cx="12" cy="12" r="3" fill="var(--chat-brand-color, ${WebBrain.config.brandColor})"/>\n          </svg>\n        </div>\n        <div class="web-brain-login-message">\n          ${WebBrain.config.loginWelcomeMessage}\n        </div>\n        <div class="web-brain-login-message-secondary">\n          Please login to continue\n        </div>\n        <div id="web-brain-google-login-container" style="display: flex; justify-content: center; width: 100%;">\n          <div class="web-brain-google-login-button"></div>\n        </div>\n        </div>\n        \x3c!-- Error message will be dynamically added here when needed --\x3e\n      </div>\n    `;return n.querySelector(".web-brain-google-login-button").addEventListener("click",(function(n){n.stopPropagation()})),n},WebBrain._showLoginOverlay=function(){if(WebBrain.loginOverlay){WebBrain.loginOverlay.style.display="flex";const n=WebBrain.loginOverlay.querySelector(".web-brain-login-error");n&&(n.style.display="none")}else WebBrain.loginOverlay=WebBrain._createLoginOverlay(),WebBrain.panel.appendChild(WebBrain.loginOverlay),WebBrain._checkAndInitializeGoogleButton();WebBrain.logoutButton&&(WebBrain.logoutButton.style.display="none")},WebBrain._hideLoginOverlay=function(){WebBrain.loginOverlay&&(WebBrain.loginOverlay.style.display="none",WebBrain.logoutButton&&WebBrain.config.requireLogin&&(WebBrain.logoutButton.style.display="block"))}}();